import{_ as i,r as c,o as y,c as d,b as s,a as o,w as l,d as n,e as t}from"./app-0338c3c8.js";const C={},u=s("h1",{id:"docker-部署-rtmp-流媒体服务器",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#docker-部署-rtmp-流媒体服务器","aria-hidden":"true"},"#"),n(" Docker 部署 RTMP 流媒体服务器")],-1),v=s("p",null,"Docker 部署 RTMP 流媒体服务器，在一端使用 RTMP 协议推流，并在前端播放直播内容。",-1),E={class:"table-of-contents"},m=s("h2",{id:"1-创建-docker-容器",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#1-创建-docker-容器","aria-hidden":"true"},"#"),n(" 1. 创建 Docker 容器")],-1),b=s("p",null,"拉取镜像：",-1),h=s("div",{class:"language-bash","data-ext":"sh"},[s("pre",{class:"shiki dark-plus",style:{"background-color":"#1E1E1E"},tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#DCDCAA"}},"docker"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#CE9178"}},"pull"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#CE9178"}},"ubuntu:20.04")]),n(`
`),s("span",{class:"line"})])])],-1),g=s("p",null,"创建 Docker 容器：",-1),A=s("div",{class:"language-bash","data-ext":"sh"},[s("pre",{class:"shiki dark-plus",style:{"background-color":"#1E1E1E"},tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#DCDCAA"}},"docker"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#CE9178"}},"run"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#569CD6"}},"-itd"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#D7BA7D"}},"\\")]),n(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4"}},"    "),s("span",{style:{color:"#569CD6"}},"--name"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#CE9178"}},"nginx-flv"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#D7BA7D"}},"\\")]),n(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4"}},"    "),s("span",{style:{color:"#569CD6"}},"-p"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#B5CEA8"}},"1935"),s("span",{style:{color:"#CE9178"}},":1935"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#D7BA7D"}},"\\")]),n(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4"}},"    "),s("span",{style:{color:"#569CD6"}},"-p"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#B5CEA8"}},"8089"),s("span",{style:{color:"#CE9178"}},":8089"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#D7BA7D"}},"\\")]),n(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4"}},"    "),s("span",{style:{color:"#CE9178"}},"ubuntu:20.04"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#D7BA7D"}},"\\")]),n(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4"}},"    "),s("span",{style:{color:"#CE9178"}},"/bin/bash")]),n(`
`),s("span",{class:"line"})])])],-1),k=s("p",null,"拉取镜像：",-1),x=s("div",{class:"language-bash","data-ext":"sh"},[s("pre",{class:"shiki dark-plus",style:{"background-color":"#1E1E1E"},tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#DCDCAA"}},"docker"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#CE9178"}},"pull"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#CE9178"}},"centos:7.9.2009")]),n(`
`),s("span",{class:"line"})])])],-1),_=s("p",null,"创建 Docker 容器：",-1),f=s("div",{class:"language-bash","data-ext":"sh"},[s("pre",{class:"shiki dark-plus",style:{"background-color":"#1E1E1E"},tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#DCDCAA"}},"docker"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#CE9178"}},"run"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#569CD6"}},"-itd"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#D7BA7D"}},"\\")]),n(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4"}},"    "),s("span",{style:{color:"#569CD6"}},"--name"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#CE9178"}},"nginx-flv"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#D7BA7D"}},"\\")]),n(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4"}},"    "),s("span",{style:{color:"#569CD6"}},"-p"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#B5CEA8"}},"1935"),s("span",{style:{color:"#CE9178"}},":1935"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#D7BA7D"}},"\\")]),n(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4"}},"    "),s("span",{style:{color:"#569CD6"}},"-p"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#B5CEA8"}},"8089"),s("span",{style:{color:"#CE9178"}},":8089"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#D7BA7D"}},"\\")]),n(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4"}},"    "),s("span",{style:{color:"#CE9178"}},"centos:7.9.2009"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#D7BA7D"}},"\\")]),n(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4"}},"    "),s("span",{style:{color:"#CE9178"}},"/bin/bash")]),n(`
`),s("span",{class:"line"})])])],-1),q=t(`<p>然后进入容器：</p><div class="language-bash" data-ext="sh"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#DCDCAA;">docker</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">exec</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">-it</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">nginx-flv</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">/bin/bash</span></span>
<span class="line"></span></code></pre></div><p>下面的命令都在容器内执行。</p><h2 id="2-源码编译" tabindex="-1"><a class="header-anchor" href="#2-源码编译" aria-hidden="true">#</a> 2. 源码编译</h2>`,4),F=s("p",null,"请先配置好镜像源，然后更新并安装包：",-1),B=s("div",{class:"language-bash","data-ext":"sh"},[s("pre",{class:"shiki dark-plus",style:{"background-color":"#1E1E1E"},tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#DCDCAA"}},"apt"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#CE9178"}},"update")]),n(`
`),s("span",{class:"line"}),n(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DCDCAA"}},"apt"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#CE9178"}},"install"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#CE9178"}},"gcc"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#CE9178"}},"wget"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#CE9178"}},"unzip"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#CE9178"}},"make")]),n(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DCDCAA"}},"apt"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#CE9178"}},"install"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#CE9178"}},"openssl"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#CE9178"}},"libssl-dev")]),n(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DCDCAA"}},"apt"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#CE9178"}},"install"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#CE9178"}},"libpcre3"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#CE9178"}},"libpcre3-dev")]),n(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DCDCAA"}},"apt"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#CE9178"}},"install"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#CE9178"}},"zlib1g-dev")]),n(`
`),s("span",{class:"line"})])])],-1),w=s("p",null,"请先配置好镜像源，然后更新并安装包：",-1),z=s("div",{class:"language-bash","data-ext":"sh"},[s("pre",{class:"shiki dark-plus",style:{"background-color":"#1E1E1E"},tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#DCDCAA"}},"yum"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#CE9178"}},"update")]),n(`
`),s("span",{class:"line"}),n(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DCDCAA"}},"yum"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#CE9178"}},"install"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#CE9178"}},"gcc")]),n(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DCDCAA"}},"yum"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#CE9178"}},"install"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#CE9178"}},"pcre"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#CE9178"}},"pcre-devel")]),n(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DCDCAA"}},"yum"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#CE9178"}},"install"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#CE9178"}},"openssl"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#CE9178"}},"openssl-devel")]),n(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DCDCAA"}},"yum"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#CE9178"}},"install"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#CE9178"}},"wget"),s("span",{style:{color:"#D4D4D4"}}," "),s("span",{style:{color:"#CE9178"}},"unzip")]),n(`
`),s("span",{class:"line"})])])],-1),P={href:"http://nginx.org/",target:"_blank",rel:"noopener noreferrer"},$=t(`<div class="language-bash" data-ext="sh"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#DCDCAA;">wget</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">http://nginx.org/download/nginx-1.23.3.tar.gz</span></span>
<span class="line"><span style="color:#DCDCAA;">wget</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">https://github.com/winshining/nginx-http-flv-module/archive/refs/heads/master.zip</span></span>
<span class="line"><span style="color:#DCDCAA;">tar</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">-zxvf</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">nginx-1.23.3.tar.gz</span></span>
<span class="line"><span style="color:#DCDCAA;">unzip</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">master.zip</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DCDCAA;">cd</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">nginx-1.23.3</span></span>
<span class="line"><span style="color:#DCDCAA;">./configure</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">--with-http_ssl_module</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">--with-http_secure_link_module</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">--add-module=../nginx-http-flv-module-master</span></span>
<span class="line"><span style="color:#DCDCAA;">make</span></span>
<span class="line"><span style="color:#DCDCAA;">make</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">install</span></span>
<span class="line"></span></code></pre></div><p>下面修改 <code>/usr/local/nginx/conf/nginx.conf</code>：</p><div class="language-nginx line-numbers-mode" data-ext="nginx"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">worker_processes </span><span style="color:#D4D4D4;">auto;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">events</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">   </span><span style="color:#569CD6;"> worker_connections </span><span style="color:#D4D4D4;"> </span><span style="color:#B5CEA8;">1024</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">http</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">server</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">       </span><span style="color:#569CD6;"> listen </span><span style="color:#D4D4D4;">8089;</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">location</span><span style="color:#D4D4D4;"> /flv {</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#569CD6;">flv_live</span><span style="color:#D4D4D4;"> on;</span></span>
<span class="line"><span style="color:#D4D4D4;">           </span><span style="color:#569CD6;"> chunked_transfer_encoding </span><span style="color:#D4D4D4;">on;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">           </span><span style="color:#569CD6;"> add_header </span><span style="color:#CE9178;">&#39;Access-Control-Allow-Origin&#39;</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;*&#39;</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">           </span><span style="color:#569CD6;"> add_header </span><span style="color:#CE9178;">&#39;Access-Control-Allow-Credentials&#39;</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;true&#39;</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">        }</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"><span style="color:#569CD6;">rtmp_auto_push</span><span style="color:#D4D4D4;"> on;</span></span>
<span class="line"><span style="color:#569CD6;">rtmp</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">server</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">       </span><span style="color:#569CD6;"> listen </span><span style="color:#D4D4D4;">1935;</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">notify_method</span><span style="color:#D4D4D4;"> get;</span></span>
<span class="line"><span style="color:#D4D4D4;">       </span><span style="color:#569CD6;"> access_log </span><span style="color:#D4D4D4;"> /var/log/nginx/access.log;</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">chunk_size</span><span style="color:#D4D4D4;"> 4096;</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">application</span><span style="color:#D4D4D4;"> live {</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#569CD6;">live</span><span style="color:#D4D4D4;"> on;</span></span>
<span class="line"><span style="color:#D4D4D4;">           </span><span style="color:#569CD6;"> allow </span><span style="color:#D4D4D4;">publish</span><span style="color:#569CD6;"> all</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">           </span><span style="color:#569CD6;"> allow </span><span style="color:#D4D4D4;">play</span><span style="color:#569CD6;"> all</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#569CD6;">drop_idle_publisher</span><span style="color:#D4D4D4;"> 20s;</span></span>
<span class="line"><span style="color:#D4D4D4;">        }</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试、启动 Nginx：</p><div class="language-bash" data-ext="sh"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#DCDCAA;">mkdir</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">-p</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">/var/log/nginx</span></span>
<span class="line"><span style="color:#DCDCAA;">/usr/local/nginx/sbin/nginx</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">-t</span></span>
<span class="line"><span style="color:#DCDCAA;">/usr/local/nginx/sbin/nginx</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">s</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">reload</span></span>
<span class="line"></span></code></pre></div><h2 id="3-直播推流" tabindex="-1"><a class="header-anchor" href="#3-直播推流" aria-hidden="true">#</a> 3. 直播推流</h2><p>可以将下面的 <code>\${IP}</code> 替换为你的 IP 地址。推送视频 <code>test.mp4</code>：</p><div class="language-bash" data-ext="sh"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#DCDCAA;">ffmpeg</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">-re</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">-i</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">test.mp4</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">-c</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">copy</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">-f</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">flv</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&quot;rtmp://\${</span><span style="color:#9CDCFE;">IP</span><span style="color:#CE9178;">}:1935/live/test&quot;</span></span>
<span class="line"></span></code></pre></div><p>拉取直播：</p><div class="language-bash" data-ext="sh"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#DCDCAA;">ffplay</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&quot;rtmp://\${</span><span style="color:#9CDCFE;">IP</span><span style="color:#CE9178;">}:1935/live/test&quot;</span></span>
<span class="line"></span></code></pre></div><p>推送摄像头内容：</p><div class="language-bash" data-ext="sh"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#DCDCAA;">ffmpeg</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">-f</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">dshow</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">-i</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">video=&quot;\${</span><span style="color:#9CDCFE;">Your_Camera</span><span style="color:#CE9178;">}&quot;:audio=&quot;\${</span><span style="color:#9CDCFE;">Your_Audio</span><span style="color:#CE9178;">}&quot;</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">-vcodec</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">libx264</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">-acodec</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">aac</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">-f</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">flv</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&quot;rtmp://\${</span><span style="color:#9CDCFE;">IP</span><span style="color:#CE9178;">}:1935/live/test&quot;</span></span>
<span class="line"></span></code></pre></div><p>将视频和音频设备名称填在上方命令的视频和音频位置上即可。</p><div class="hint-container tip"><p class="hint-container-title">查看摄像头</p><p>查看视频和音频设备：</p><div class="language-bash" data-ext="sh"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#DCDCAA;">ffmpeg</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">-list_devices</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">-f</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">dshow</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">-i</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">dummy</span></span>
<span class="line"></span></code></pre></div><p>播放摄像头当前内容：</p><div class="language-bash" data-ext="sh"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#DCDCAA;">ffplay</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">-f</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">dshow</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">-i</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">video=&quot;\${</span><span style="color:#9CDCFE;">Your_Camera</span><span style="color:#CE9178;">}&quot;</span></span>
<span class="line"></span></code></pre></div><p>也可以同时播放麦克风的内容，但最好戴上耳机，不然可能产生回声：</p><div class="language-bash" data-ext="sh"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#DCDCAA;">ffplay</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">-f</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">dshow</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">-i</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">video=&quot;\${</span><span style="color:#9CDCFE;">Your_Camera</span><span style="color:#CE9178;">}&quot;:audio=&quot;\${</span><span style="color:#9CDCFE;">Your_Audio</span><span style="color:#CE9178;">}&quot;</span></span>
<span class="line"></span></code></pre></div></div><p>测试代码如下，保存为 <code>index.html</code>：</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#808080;">&lt;!</span><span style="color:#569CD6;">DOCTYPE</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">html</span><span style="color:#808080;">&gt;</span></span>
<span class="line"><span style="color:#808080;">&lt;</span><span style="color:#569CD6;">html</span><span style="color:#808080;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#808080;">&lt;</span><span style="color:#569CD6;">head</span><span style="color:#808080;">&gt;</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#808080;">&lt;</span><span style="color:#569CD6;">meta</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">charset</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&quot;UTF-8&quot;</span><span style="color:#D4D4D4;"> </span><span style="color:#808080;">/&gt;</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#808080;">&lt;</span><span style="color:#569CD6;">title</span><span style="color:#808080;">&gt;</span><span style="color:#D4D4D4;">FLV Player</span><span style="color:#808080;">&lt;/</span><span style="color:#569CD6;">title</span><span style="color:#808080;">&gt;</span></span>
<span class="line"><span style="color:#808080;">&lt;/</span><span style="color:#569CD6;">head</span><span style="color:#808080;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#808080;">&lt;</span><span style="color:#569CD6;">body</span><span style="color:#808080;">&gt;</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#808080;">&lt;</span><span style="color:#569CD6;">script</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">src</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&quot;https://cdn.bootcss.com/flv.js/1.6.2/flv.min.js&quot;</span><span style="color:#808080;">&gt;&lt;/</span><span style="color:#569CD6;">script</span><span style="color:#808080;">&gt;</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#808080;">&lt;</span><span style="color:#569CD6;">video</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">id</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&quot;videoElement&quot;</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">style</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&quot;width: 80%&quot;</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">controls</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&quot;controls&quot;</span><span style="color:#808080;">&gt;&lt;/</span><span style="color:#569CD6;">video</span><span style="color:#808080;">&gt;</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#808080;">&lt;</span><span style="color:#569CD6;">script</span><span style="color:#808080;">&gt;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">flvjs</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">isSupported</span><span style="color:#D4D4D4;">()) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#569CD6;">var</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">videoElement</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">document</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getElementById</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;videoElement&#39;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#569CD6;">var</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">flvPlayer</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">flvjs</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">createPlayer</span><span style="color:#D4D4D4;">({</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">type:</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;flv&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">url:</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;http://\${IP}:8089/flv?app=live&amp;stream=test&#39;</span></span>
<span class="line"><span style="color:#D4D4D4;">      })</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">flvPlayer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">attachMediaElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">videoElement</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">flvPlayer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">load</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">flvPlayer</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">play</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#808080;">&lt;/</span><span style="color:#569CD6;">script</span><span style="color:#808080;">&gt;</span></span>
<span class="line"><span style="color:#808080;">&lt;/</span><span style="color:#569CD6;">body</span><span style="color:#808080;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#808080;">&lt;/</span><span style="color:#569CD6;">html</span><span style="color:#808080;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="4-使用-dockerfile" tabindex="-1"><a class="header-anchor" href="#4-使用-dockerfile" aria-hidden="true">#</a> 4. 使用 Dockerfile</h2><p>推荐使用 <code>Dockerfile</code>，下载源代码，保存上述配置文件为 <code>nginx.conf</code>，然后构建。</p><div class="language-bash" data-ext="sh"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#DCDCAA;">curl</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">-Lj</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">-o</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">nginx-1.23.3.tar.gz</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">http://nginx.org/download/nginx-1.23.3.tar.gz</span></span>
<span class="line"><span style="color:#DCDCAA;">curl</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">-Lj</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">-o</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">nginx-http-flv-module-master.zip</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">https://github.com/winshining/nginx-http-flv-module/archive/refs/heads/master.zip</span></span>
<span class="line"></span></code></pre></div><p>下面是使用 Ubuntu 镜像为例的 <code>Dockerfile</code> 文件：</p><div class="language-docker line-numbers-mode" data-ext="docker"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> ubuntu:20.04</span></span>
<span class="line"><span style="color:#569CD6;">WORKDIR</span><span style="color:#D4D4D4;"> /app</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">COPY</span><span style="color:#D4D4D4;"> nginx-1.23.3.tar.gz .</span></span>
<span class="line"><span style="color:#569CD6;">COPY</span><span style="color:#D4D4D4;"> nginx-http-flv-module-master.zip .</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">RUN</span><span style="color:#D4D4D4;"> apt update &amp;&amp; apt upgrade -y \\</span></span>
<span class="line"><span style="color:#D4D4D4;">    &amp;&amp; apt install -y gcc wget unzip make tar \\</span></span>
<span class="line"><span style="color:#D4D4D4;">    &amp;&amp; apt install -y openssl libssl-dev \\</span></span>
<span class="line"><span style="color:#D4D4D4;">    &amp;&amp; apt install -y libpcre3 libpcre3-dev \\</span></span>
<span class="line"><span style="color:#D4D4D4;">    &amp;&amp; apt install -y zlib1g-dev \\</span></span>
<span class="line"><span style="color:#D4D4D4;">    &amp;&amp; tar -zxvf nginx-1.23.3.tar.gz \\</span></span>
<span class="line"><span style="color:#D4D4D4;">    &amp;&amp; unzip nginx-http-flv-module-master.zip \\</span></span>
<span class="line"><span style="color:#D4D4D4;">    &amp;&amp; rm nginx-http-flv-module-master.zip -rf \\</span></span>
<span class="line"><span style="color:#D4D4D4;">    &amp;&amp; rm nginx-1.23.3.tar.gz -rf \\</span></span>
<span class="line"><span style="color:#D4D4D4;">    &amp;&amp; cd nginx-1.23.3 \\</span></span>
<span class="line"><span style="color:#D4D4D4;">    &amp;&amp; ./configure --with-http_ssl_module --with-http_secure_link_module --add-module=../nginx-http-flv-module-master \\</span></span>
<span class="line"><span style="color:#D4D4D4;">    &amp;&amp; make \\</span></span>
<span class="line"><span style="color:#D4D4D4;">    &amp;&amp; make install \\</span></span>
<span class="line"><span style="color:#D4D4D4;">    &amp;&amp; cd ..</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">EXPOSE</span><span style="color:#D4D4D4;"> 8089 1935</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">CMD</span><span style="color:#D4D4D4;"> [</span><span style="color:#CE9178;">&quot;/usr/local/nginx/sbin/nginx&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;-g&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;daemon off;&quot;</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>执行命令构建并启动：</p><div class="language-bash" data-ext="sh"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#DCDCAA;">docker</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">build</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">-t</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">nginx-flv:v1</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">.</span></span>
<span class="line"><span style="color:#DCDCAA;">docker</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">run</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">-itd</span><span style="color:#D4D4D4;"> </span><span style="color:#D7BA7D;">\\</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">--name</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">nginx-flv</span><span style="color:#D4D4D4;"> </span><span style="color:#D7BA7D;">\\</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">-v</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">$PWD</span><span style="color:#CE9178;">/nginx.conf:/usr/local/nginx/conf/nginx.conf</span><span style="color:#D4D4D4;"> </span><span style="color:#D7BA7D;">\\</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">-v</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">$PWD</span><span style="color:#CE9178;">/log:/var/log/nginx</span><span style="color:#D4D4D4;"> </span><span style="color:#D7BA7D;">\\</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">-p</span><span style="color:#D4D4D4;"> </span><span style="color:#B5CEA8;">1935</span><span style="color:#CE9178;">:1935</span><span style="color:#D4D4D4;"> </span><span style="color:#D7BA7D;">\\</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">-p</span><span style="color:#D4D4D4;"> </span><span style="color:#B5CEA8;">8089</span><span style="color:#CE9178;">:8089</span><span style="color:#D4D4D4;"> </span><span style="color:#D7BA7D;">\\</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">nginx-flv:v1</span></span>
<span class="line"></span></code></pre></div>`,23);function O(I,T){const e=c("router-link"),D=c("Tabs"),r=c("ExternalLinkIcon");return y(),d("div",null,[u,v,s("nav",E,[s("ul",null,[s("li",null,[o(e,{to:"#1-创建-docker-容器"},{default:l(()=>[n("1. 创建 Docker 容器")]),_:1})]),s("li",null,[o(e,{to:"#2-源码编译"},{default:l(()=>[n("2. 源码编译")]),_:1})]),s("li",null,[o(e,{to:"#3-直播推流"},{default:l(()=>[n("3. 直播推流")]),_:1})]),s("li",null,[o(e,{to:"#4-使用-dockerfile"},{default:l(()=>[n("4. 使用 Dockerfile")]),_:1})])])]),m,o(D,{id:"12",data:[{id:"Ubuntu 20.04"},{id:"CentOS 7.9.2009"}],"tab-id":"sys"},{title0:l(({value:a,isActive:p})=>[n("Ubuntu 20.04")]),title1:l(({value:a,isActive:p})=>[n("CentOS 7.9.2009")]),tab0:l(({value:a,isActive:p})=>[b,h,g,A]),tab1:l(({value:a,isActive:p})=>[k,x,_,f]),_:1}),q,o(D,{id:"44",data:[{id:"Ubuntu 20.04"},{id:"CentOS 7.9.2009"}],"tab-id":"sys"},{title0:l(({value:a,isActive:p})=>[n("Ubuntu 20.04")]),title1:l(({value:a,isActive:p})=>[n("CentOS 7.9.2009")]),tab0:l(({value:a,isActive:p})=>[F,B]),tab1:l(({value:a,isActive:p})=>[w,z]),_:1}),s("p",null,[n("编译 Nginx 和 HTTP-FLV，"),s("a",P,[n("Nginx 官网"),o(r)]),n(" 可以查看最新版本：")]),$])}const Y=i(C,[["render",O],["__file","nginx-flv.html.vue"]]);export{Y as default};
